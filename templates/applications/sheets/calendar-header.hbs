<header class="calendar-header">
  {{!-- Search panel (absolute dropdown) --}}
  <div class="calendaria-search{{#if searchOpen}} visible{{/if}}">
    <div class="search-panel-header">
      <input type="search" class="search-input" name="search" placeholder="{{localize 'CALENDARIA.Search.Placeholder'}}"
        value="{{searchTerm}}" autocomplete="off">
    </div>
    <div class="search-panel-results">
      {{#if searchResults.length}}
        {{#each searchResults}}
          <div class="search-result-item" data-action="openSearchResult" data-id="{{id}}"
            data-journal-id="{{data.journalId}}">
            <span class="result-name">{{name}}</span>
            {{#if description}}<span class="result-description">{{description}}</span>{{/if}}
          </div>
        {{/each}}
      {{else if searchTerm}}
        <div class="no-results">
          <i class="fas fa-search"></i>
          <span>{{localize "CALENDARIA.Search.NoResults"}}</span>
        </div>
      {{/if}}
    </div>
  </div>

  {{!-- Row 1: < | Search | Note | Date | SwitchView | Settings | > --}}
  <div class="header-row header-row-top">
    <button type="button" data-action="navigate" data-direction="previous" data-tooltip
      aria-label="{{#if (eq displayMode 'week')}}{{localize 'CALENDARIA.CalendarApp.PreviousWeek'}}{{else if (eq displayMode 'year')}}{{localize 'CALENDARIA.CalendarApp.PreviousYears'}}{{else}}{{localize 'CALENDARIA.Common.PreviousMonth'}}{{/if}}">
      <i class="fas fa-chevron-left"></i>
    </button>

    <button type="button" class="search-toggle" data-action="toggleSearch" data-tooltip
      aria-label="{{localize 'CALENDARIA.Common.SearchNotes'}}">
      <i class="fas fa-search"></i>
    </button>

    {{#if canAddNotes}}
      <button type="button" data-action="addNoteToday" data-tooltip
        aria-label="{{localize 'CALENDARIA.CalendarApp.AddNoteToday'}}" class="add-note-today-btn">
        <i class="fas fa-plus"></i>
      </button>
    {{/if}}

    <h2 class="calendar-title">
      {{#if calendarData}} {{#if (eq displayMode 'week')}} {{{calendarData.formattedHeader}}}
        {{else if (eq displayMode 'year')}}
          {{calendarData.startYearDisplay}} - {{calendarData.endYearDisplay}}
        {{else}} {{{calendarData.formattedHeader}}} {{/if}}
      {{else}} {{localize 'CALENDARIA.Common.Calendar'}} {{/if}}
    </h2>

    <button type="button" data-action="toggleCompact" data-tooltip
      aria-label="{{localize 'CALENDARIA.CalendarApp.ToggleCompact'}}" class="toggle-compact-btn">
      <i class="fas fa-compress"></i>
    </button>

    <button type="button" data-action="openSettings" data-tooltip
      aria-label="{{localize 'CALENDARIA.HUD.Settings.Name'}}" class="settings-btn">
      <i class="fas fa-gear"></i>
    </button>

    <button type="button" data-action="navigate" data-direction="next" data-tooltip
      aria-label="{{#if (eq displayMode 'week')}}{{localize 'CALENDARIA.CalendarApp.NextWeek'}}{{else if (eq displayMode 'year')}}{{localize 'CALENDARIA.CalendarApp.NextYears'}}{{else}}{{localize 'CALENDARIA.Common.NextMonth'}}{{/if}}">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>

  {{!-- Row 2: MWY Select | Indicators (flex) | Today + SetDate --}}
  <div class="header-row header-row-bottom">
    <select class="view-select">
      <option value="month" {{#if (eq displayMode 'month')}}selected{{/if}}>{{localize 'CALENDARIA.Common.Month'}}</option>
      <option value="week" {{#if (eq displayMode 'week')}}selected{{/if}}>{{localize 'CALENDARIA.Common.Week'}}</option>
      <option value="year" {{#if (eq displayMode 'year')}}selected{{/if}}>{{localize 'CALENDARIA.Common.Year'}}</option>
    </select>

    <div class="calendar-indicators">
      {{{widgets.weatherIndicator}}}
      {{{widgets.seasonIndicator}}}
      {{{widgets.eraIndicator}}}
      {{{widgets.cycleIndicator}}}
      {{{widgets.indicators}}}
    </div>

    <div class="calendar-actions">
      <button type="button" data-action="today" data-tooltip aria-label="{{localize 'CALENDARIA.CalendarApp.GoToToday'}}">
        <i class="fas fa-calendar-day"></i>
      </button>

      {{#if editable}}
        <button type="button" data-action="setAsCurrentDate" data-tooltip
          aria-label="{{#if isToday}}{{localize 'CALENDARIA.CalendarApp.CurrentDateBtn'}}{{else}}{{localize 'CALENDARIA.CalendarApp.SetAsCurrent'}}{{/if}}"
          class="set-current-date-btn" {{#if isToday}}disabled{{/if}}>
          <i class="fas fa-calendar-check"></i>
        </button>
      {{/if}}

      {{!-- Custom widget actions insertion point --}}
      {{{widgets.actions}}}
    </div>
  </div>
</header>
