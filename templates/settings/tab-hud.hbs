<section class="tab {{tab.cssClass}}" data-tab="{{tab.id}}" data-group="{{tab.group}}">

  <div class="button-row app-controls">
    <button type="button" data-action="resetPosition" data-target="hud">
      <i class="fas fa-undo"></i>
      {{localize "CALENDARIA.Common.ResetPosition"}}
    </button>
    <button type="button" data-action="closeHUD">
      <i class="fas fa-times"></i>
      {{localize "CALENDARIA.SettingsPanel.CloseHUD"}}
    </button>
    <button type="button" data-action="openHUD">
      <i class="fas fa-external-link-alt"></i>
      {{localize "CALENDARIA.SettingsPanel.OpenHUD"}}
    </button>
  </div>
  <p class="hint section-hint">{{openHint}}</p>

  <fieldset>
    <legend>{{localize "CALENDARIA.SettingsPanel.Section.Display"}}</legend>

    <div class="form-group">
      <label for="showCalendarHUD">{{localize "CALENDARIA.Settings.ShowCalendarHUD.Name"}}</label>
      <div class="form-fields">
        <input type="checkbox" id="showCalendarHUD" name="showCalendarHUD" {{#if showCalendarHUD}}checked{{/if}}>
      </div>
      <p class="hint">{{localize "CALENDARIA.Settings.ShowCalendarHUD.Hint"}}</p>
    </div>

    {{#if isGM}}
      <div class="form-group">
        <label for="forceHUD">{{localize "CALENDARIA.Settings.ForceHUD.Name"}}</label>
        <div class="form-fields">
          <input type="checkbox" id="forceHUD" name="forceHUD" {{#if forceHUD}}checked{{/if}}>
        </div>
        <p class="hint">{{localize "CALENDARIA.Settings.ForceHUD.Hint"}}</p>
      </div>
    {{/if}}

    <div class="form-group">
      <label for="calendarHUDMode">{{localize "CALENDARIA.Settings.CalendarHUDMode.Name"}}</label>
      <div class="form-fields">
        <select id="calendarHUDMode" name="calendarHUDMode">
          {{#each hudModeOptions}}
            <option value="{{this.value}}" {{#if this.selected}}selected{{/if}}>{{this.label}}</option>
          {{/each}}
        </select>
      </div>
      <p class="hint">{{localize "CALENDARIA.Settings.CalendarHUDMode.Hint"}}</p>
    </div>

    <div class="form-group{{#if isCompactMode}} disabled{{/if}}">
      <label for="hudDialStyle">{{localize "CALENDARIA.Settings.HUDDialStyle.Name"}}</label>
      <div class="form-fields">
        <select id="hudDialStyle" name="hudDialStyle"
          {{#if isCompactMode}}disabled aria-disabled="true" title="{{localize "CALENDARIA.Settings.HUDDialStyle.DisabledTitle"}}"{{/if}}>
          {{#each dialStyleOptions}}
            <option value="{{this.value}}" {{#if this.selected}}selected{{/if}}>{{this.label}}</option>
          {{/each}}
        </select>
      </div>
      <p class="hint">
        {{#if isCompactMode}}{{localize "CALENDARIA.Settings.HUDDialStyle.DisabledHint"}}{{else}}{{localize "CALENDARIA.Settings.HUDDialStyle.Hint"}}{{/if}}
      </p>
    </div>

    <div class="form-group">
      <label for="hudTrayDirection">{{localize "CALENDARIA.Settings.HUDTrayDirection.Name"}}</label>
      <div class="form-fields">
        <select id="hudTrayDirection" name="hudTrayDirection">
          {{#each trayDirectionOptions}}
            <option value="{{this.value}}" {{#if this.selected}}selected{{/if}}>{{this.label}}</option>
          {{/each}}
        </select>
      </div>
      <p class="hint">{{localize "CALENDARIA.Settings.HUDTrayDirection.Hint"}}</p>
    </div>

    <div class="form-group{{#if hudCombatHide}} disabled{{/if}}">
      <label for="hudCombatCompact">{{localize "CALENDARIA.Settings.HUDCombatCompact.Name"}}</label>
      <div class="form-fields">
        <input type="checkbox" id="hudCombatCompact" name="hudCombatCompact" {{#if hudCombatCompact}}checked{{/if}}
          {{#if hudCombatHide}}disabled aria-disabled="true" title="{{localize "CALENDARIA.Settings.HUDCombatCompact.DisabledTitle"}}"{{/if}}>
      </div>
      <p class="hint">{{localize "CALENDARIA.Settings.HUDCombatCompact.Hint"}}</p>
    </div>

    <div class="form-group">
      <label for="hudCombatHide">{{localize "CALENDARIA.Settings.HUDCombatHide.Name"}}</label>
      <div class="form-fields">
        <input type="checkbox" id="hudCombatHide" name="hudCombatHide" {{#if hudCombatHide}}checked{{/if}}>
      </div>
      <p class="hint">{{localize "CALENDARIA.Settings.HUDCombatHide.Hint"}}</p>
    </div>

    <div class="form-group">
      <label for="hudAutoFade">{{localize "CALENDARIA.Settings.AutoFade.Name"}}</label>
      <div class="form-fields">
        <input type="checkbox" id="hudAutoFade" name="hudAutoFade" {{#if hudAutoFade}}checked{{/if}}>
      </div>
      <p class="hint">{{localize "CALENDARIA.Settings.AutoFade.Hint"}}</p>
    </div>

    <div class="form-group{{#unless hudAutoFade}} disabled{{/unless}}">
      <label for="hudIdleOpacity">{{localize "CALENDARIA.Settings.IdleOpacity.Name"}}</label>
      <div class="form-fields">
        <div class="slider-with-ticks">
          <input type="range" id="hudIdleOpacity" name="hudIdleOpacity" min="0" max="100" value="{{hudIdleOpacity}}"
            list="opacity-ticks"
            {{#unless hudAutoFade}}disabled aria-disabled="true" title="{{localize "CALENDARIA.Settings.IdleOpacity.DisabledTitle"}}"{{/unless}}>
          <datalist id="opacity-ticks">
            <option value="0"></option>
            <option value="25"></option>
            <option value="50"></option>
            <option value="75"></option>
            <option value="100"></option>
          </datalist>
          <div class="slider-ticks">
            <span></span><span></span><span></span><span></span><span></span>
          </div>
        </div>
        <input type="number" class="range-value" min="0" max="100" value="{{hudIdleOpacity}}"
          style="width: 3rem; flex: none"
          {{#unless hudAutoFade}}disabled aria-disabled="true" title="{{localize "CALENDARIA.Settings.IdleOpacity.DisabledTitle"}}"{{/unless}}>
        <span class="input-suffix">%</span>
      </div>
      <p class="hint">{{localize "CALENDARIA.Settings.IdleOpacity.Hint"}}</p>
    </div>

    <div class="form-group{{#if isCompactMode}} disabled{{/if}}">
      <label for="hudWidthScale">{{localize "CALENDARIA.Settings.HUDWidthScale.Name"}}</label>
      <div class="form-fields range-field">
        <div class="slider-with-ticks">
          <input type="range" id="hudWidthScale" name="hudWidthScale" min="0.5" max="2" step="0.05"
            value="{{hudWidthScale}}" list="scale-ticks"
            {{#if isCompactMode}}disabled aria-disabled="true" title="{{localize "CALENDARIA.Settings.HUDWidthScale.DisabledTitle"}}"{{/if}}>
          <datalist id="scale-ticks">
            <option value="0.5"></option>
            <option value="1"></option>
            <option value="1.5"></option>
            <option value="2"></option>
          </datalist>
          <div class="slider-ticks">
            <span></span><span></span><span></span><span></span>
          </div>
        </div>
        <span class="range-value">{{hudWidthScale}}x</span>
      </div>
      <p class="hint">
        {{#if isCompactMode}}{{localize "CALENDARIA.Settings.HUDWidthScale.DisabledHint"}}{{else}}{{localize "CALENDARIA.Settings.HUDWidthScale.Hint"}}{{/if}}
      </p>
    </div>
  </fieldset>

  <fieldset>
    <legend>{{localize "CALENDARIA.SettingsPanel.Section.BlockVisibility"}}</legend>
    <p class="hint section-hint">{{localize "CALENDARIA.SettingsPanel.Hint.BlockVisibility"}}</p>

    <div class="form-group">
      <label for="hudShowWeather">{{localize "CALENDARIA.Settings.HUDShowWeather.Name"}}</label>
      <div class="form-fields">
        <input type="checkbox" id="hudShowWeather" name="hudShowWeather" {{#if hudShowWeather}}checked{{/if}}>
      </div>
      <p class="hint">{{localize "CALENDARIA.Settings.HUDShowWeather.Hint"}}</p>
    </div>

    {{#unless isCompactMode}}
      <div class="form-group">
        <label for="hudWeatherDisplayMode">{{localize "CALENDARIA.Settings.HUDWeatherDisplayMode.Name"}}</label>
        <div class="form-fields">
          <select id="hudWeatherDisplayMode" name="hudWeatherDisplayMode">
            {{#each weatherDisplayModeOptions}}
              <option value="{{this.value}}" {{#if this.selected}}selected{{/if}}>{{this.label}}</option>
            {{/each}}
          </select>
        </div>
        <p class="hint">{{localize "CALENDARIA.Settings.HUDWeatherDisplayMode.Hint"}}</p>
      </div>
    {{/unless}}

    <div class="form-group">
      <label for="hudShowSeason">{{localize "CALENDARIA.Settings.HUDShowSeason.Name"}}</label>
      <div class="form-fields">
        <input type="checkbox" id="hudShowSeason" name="hudShowSeason" {{#if hudShowSeason}}checked{{/if}}>
      </div>
      <p class="hint">{{localize "CALENDARIA.Settings.HUDShowSeason.Hint"}}</p>
    </div>

    {{#unless isCompactMode}}
      <div class="form-group">
        <label for="hudSeasonDisplayMode">{{localize "CALENDARIA.Settings.HUDSeasonDisplayMode.Name"}}</label>
        <div class="form-fields">
          <select id="hudSeasonDisplayMode" name="hudSeasonDisplayMode">
            {{#each seasonDisplayModeOptions}}
              <option value="{{this.value}}" {{#if this.selected}}selected{{/if}}>{{this.label}}</option>
            {{/each}}
          </select>
        </div>
        <p class="hint">{{localize "CALENDARIA.Settings.HUDSeasonDisplayMode.Hint"}}</p>
      </div>
    {{/unless}}

    <div class="form-group">
      <label for="hudShowEra">{{localize "CALENDARIA.Settings.HUDShowEra.Name"}}</label>
      <div class="form-fields">
        <input type="checkbox" id="hudShowEra" name="hudShowEra" {{#if hudShowEra}}checked{{/if}}>
      </div>
      <p class="hint">{{localize "CALENDARIA.Settings.HUDShowEra.Hint"}}</p>
    </div>
  </fieldset>

  <fieldset>
    <legend>{{localize "CALENDARIA.SettingsPanel.Section.StickyStates"}}</legend>
    <input type="hidden" name="hudStickySection" value="1">

    <div class="form-group">
      <label for="hudStickyTray">{{localize "CALENDARIA.SettingsPanel.Sticky.Tray"}}</label>
      <div class="form-fields">
        <input type="checkbox" id="hudStickyTray" name="hudStickyTray" {{#if hudStickyTray}}checked{{/if}}>
      </div>
      <p class="hint">{{localize "CALENDARIA.SettingsPanel.Hint.StickyTray"}}</p>
    </div>

    <div class="form-group">
      <label for="calendarHUDLocked">{{localize "CALENDARIA.Common.LockPosition"}}</label>
      <div class="form-fields">
        <input type="checkbox" id="calendarHUDLocked" name="calendarHUDLocked" {{#if calendarHUDLocked}}checked{{/if}}>
      </div>
      <p class="hint">{{localize "CALENDARIA.SettingsPanel.Hint.LockHUDPosition"}}</p>
    </div>
  </fieldset>

  {{#if isGM}}
    <fieldset>
      <legend>{{localize "CALENDARIA.SettingsPanel.Section.CustomTimeJumps"}}</legend>
      <p class="hint section-hint">{{localize "CALENDARIA.SettingsPanel.Hint.CustomTimeJumps"}}</p>

      <div class="time-jumps-grid">
        <div class="time-jumps-header">
          <span></span>
          <span>{{localize "CALENDARIA.SettingsPanel.TimeJumps.MajorDecrement"}}</span>
          <span>{{localize "CALENDARIA.SettingsPanel.TimeJumps.MinorDecrement"}}</span>
          <span>{{localize "CALENDARIA.SettingsPanel.TimeJumps.MinorIncrement"}}</span>
          <span>{{localize "CALENDARIA.SettingsPanel.TimeJumps.MajorIncrement"}}</span>
        </div>
        {{#each customTimeJumps}}
          <div class="time-jumps-row">
            <label>{{label}}</label>
            <input type="number" name="customTimeJumps.{{key}}.dec2" value="{{jumps.dec2}}"
              aria-label="{{label}} {{localize "CALENDARIA.SettingsPanel.TimeJumps.MajorDecrement"}}">
            <input type="number" name="customTimeJumps.{{key}}.dec1" value="{{jumps.dec1}}"
              aria-label="{{label}} {{localize "CALENDARIA.SettingsPanel.TimeJumps.MinorDecrement"}}">
            <input type="number" name="customTimeJumps.{{key}}.inc1" value="{{jumps.inc1}}"
              aria-label="{{label}} {{localize "CALENDARIA.SettingsPanel.TimeJumps.MinorIncrement"}}">
            <input type="number" name="customTimeJumps.{{key}}.inc2" value="{{jumps.inc2}}"
              aria-label="{{label}} {{localize "CALENDARIA.SettingsPanel.TimeJumps.MajorIncrement"}}">
          </div>
        {{/each}}
      </div>
    </fieldset>

    <fieldset>
      <legend>{{localize "CALENDARIA.SettingsPanel.Section.DisplayFormats"}} <a data-action="showTokenReference"
          data-context-type="date"><i class="fa-regular fa-circle-question"></i></a></legend>
      <p class="hint section-hint">{{localize "CALENDARIA.SettingsPanel.Hint.FormatSettings"}}</p>

      {{#each formatLocations}}
        <div class="format-location" data-location="{{id}}">
          <div class="form-group">
            <label>{{label}}</label>
          </div>

          <div class="format-row">
            <div class="format-column">
              <span class="format-label">{{localize "CALENDARIA.Format.GMFormat"}}</span>
              <select name="displayFormats.{{id}}.gmPreset" data-location="{{id}}" data-role="gm">
                {{#each gmPresetOptions}}
                  <option value="{{value}}" {{#if selected}}selected{{/if}}>{{label}}</option>
                {{/each}}
              </select>
              <input type="text" name="displayFormats.{{id}}.gmCustom" value="{{#if isCustomGM}}{{gmFormat}}{{/if}}"
                placeholder="D MMMM YYYY" class="format-custom-input {{#unless isCustomGM}}hidden{{/unless}}"
                data-location="{{id}}" data-role="gm">
            </div>

            <div class="format-column">
              <span class="format-label">{{localize "CALENDARIA.Format.PlayerFormat"}}</span>
              <select name="displayFormats.{{id}}.playerPreset" data-location="{{id}}" data-role="player">
                {{#each playerPresetOptions}}
                  <option value="{{value}}" {{#if selected}}selected{{/if}}>{{label}}</option>
                {{/each}}
              </select>
              <input type="text" name="displayFormats.{{id}}.playerCustom"
                value="{{#if isCustomPlayer}}{{playerFormat}}{{/if}}" placeholder="D MMMM YYYY"
                class="format-custom-input {{#unless isCustomPlayer}}hidden{{/unless}}" data-location="{{id}}"
                data-role="player">
            </div>
          </div>
        </div>
      {{/each}}
    </fieldset>
  {{/if}}

</section>
